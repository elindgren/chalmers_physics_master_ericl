LAMMPS (7 Aug 2019)
# Reference: M. Orsi, Comparative assessment of the ELBA coarse-grained
# model for water, Molecular Physics (2014), 112, 1566-1576

units real
atom_style full
read_data data.singleTIP4P-2005
  orthogonal box = (0 0 0) to (3.1 3.1 3.1)
  2 by 2 by 3 MPI processor grid
  reading atoms ...
  3 atoms
  scanning bonds ...
  2 = max bonds/atom
  scanning angles ...
  1 = max angles/atom
  reading bonds ...
  2 bonds
  reading angles ...
  1 angles
  2 = max # of 1-2 neighbors
  1 = max # of 1-3 neighbors
  1 = max # of 1-4 neighbors
  2 = max # of special neighbors
  special bonds CPU = 0.00089407 secs
  read_data CPU = 0.00757504 secs
include forcefield.TIP4P-2005
# This forcefield file sets a 13-Angstrom cutoff, recommended for liquid-
# vapor simulations [Vega & de Miguel, J Chem Phys 126:154707 (2007),
# Vega et al, Faraday Discuss 141:251 (2009)]
# Note that the original TIP4P/2005 model was run with an 8.5 Angstrom
# cutoff [Abascal & Vega, J Chem Phys 123:234505 (2005)].
# Charges and geometry are specified in the "data." file.

mass 1 1.00794 # H
mass 2 15.9994 # O

pair_style lj/cut/tip4p/long 2 1 1 1 0.1546 13.0
pair_modify tail yes
kspace_style pppm/tip4p 1.0e-5

pair_coeff 1 1 0.0 0.0
pair_coeff 1 2 0.0 0.0
pair_coeff 2 2 0.18520 3.1589

bond_style harmonic
bond_coeff 1 0.0 0.9572

angle_style harmonic
angle_coeff 1 0.0 104.52
pair_modify tail no

replicate 10 10 10
  orthogonal box = (0 0 0) to (31 31 31)
  2 by 2 by 3 MPI processor grid
  3000 atoms
  2000 bonds
  1000 angles
  2 = max # of 1-2 neighbors
  1 = max # of 1-3 neighbors
  1 = max # of 1-4 neighbors
  2 = max # of special neighbors
  special bonds CPU = 0.000708103 secs
  replicate CPU = 0.0015378 secs

variable xLo equal -0.5*lx
variable xHi equal 0.5*lx
variable yLo equal -0.5*ly
variable yHi equal 0.5*ly
variable zLo equal -0.5*lz
variable zHi equal 0.5*lz

# Recenter system coords about the origin (0,0,0):
displace_atoms all move ${xLo} ${yLo} ${zLo} units box
displace_atoms all move -15.5 ${yLo} ${zLo} units box
displace_atoms all move -15.5 -15.5 ${zLo} units box
displace_atoms all move -15.5 -15.5 -15.5 units box

# Adjust box dimensions:
change_box all x final ${xLo} ${xHi} units box
change_box all x final -15.5 ${xHi} units box
change_box all x final -15.5 15.5 units box
  orthogonal box = (-15.5 0 0) to (15.5 31 31)
change_box all y final ${yLo} ${yHi} units box
change_box all y final -15.5 ${yHi} units box
change_box all y final -15.5 15.5 units box
  orthogonal box = (-15.5 -15.5 0) to (15.5 15.5 31)
change_box all z final ${zLo} ${zHi} units box
change_box all z final -15.5 ${zHi} units box
change_box all z final -15.5 15.5 units box
  orthogonal box = (-15.5 -15.5 -15.5) to (15.5 15.5 15.5)

# Increase z edge to yield "Vacuum|Water|Vacuum" system:
variable zLoNew equal -2.0*lz
variable zHiNew equal 2.0*lz
change_box all z final ${zLoNew} ${zHiNew} units box
change_box all z final -62 ${zHiNew} units box
change_box all z final -62 62 units box
  orthogonal box = (-15.5 -15.5 -62) to (15.5 15.5 62)

variable Nblock equal 1000
variable Nrun equal 2.0*${Nblock}
variable Nrun equal 2.0*1000
variable Ndump equal 10
variable Ne equal 10
variable Nr equal ${Nblock}/${Ne}
variable Nr equal 1000/${Ne}
variable Nr equal 1000/10
variable Nf equal ${Nrun}
variable Nf equal 2000
variable Dz equal 0.1

variable A_in_m equal 1e-10 # Angstrom in meter
variable atm_in_Pa equal 101325 # note: 1 Pa = 1 N/m^2
variable N_in_mN equal 1e3 # Newton in milliNewton
variable convFac equal ${A_in_m}*${atm_in_Pa}*${N_in_mN}
variable convFac equal 1e-10*${atm_in_Pa}*${N_in_mN}
variable convFac equal 1e-10*101325*${N_in_mN}
variable convFac equal 1e-10*101325*1000

variable Text equal 300

group hydrogen type 1
2000 atoms in group hydrogen
group oxygen type 2
1000 atoms in group oxygen

velocity all create ${Text} 1234
velocity all create 300 1234

neighbor 2.0 bin
neigh_modify every 1 delay 0 check yes

timestep 2.0

#fix loadBalance all balance 20 z 5 1.05

fix constrain all shake 1.0e-4 100 0 b 1 a 1
  0 = # of size 2 clusters
  0 = # of size 3 clusters
  0 = # of size 4 clusters
  1000 = # of frozen angles
  find clusters CPU = 0.00129199 secs
fix integrate all nvt temp ${Text} ${Text} 200.0
fix integrate all nvt temp 300 ${Text} 200.0
fix integrate all nvt temp 300 300 200.0
fix removeMomentum all momentum 1 linear 1 1 1

compute T all temp
fix TAve all ave/time ${Ne} ${Nr} ${Nf} c_T
fix TAve all ave/time 10 ${Nr} ${Nf} c_T
fix TAve all ave/time 10 100 ${Nf} c_T
fix TAve all ave/time 10 100 2000 c_T

variable P equal press
fix PAve all ave/time ${Ne} ${Nr} ${Nf} v_P
fix PAve all ave/time 10 ${Nr} ${Nf} v_P
fix PAve all ave/time 10 100 ${Nf} v_P
fix PAve all ave/time 10 100 2000 v_P

variable xPress equal c_thermo_press[1]
variable yPress equal c_thermo_press[2]
variable zPress equal c_thermo_press[3]

# Evaluate and average surface tension in mN/m:
variable st equal 0.5*lz*(v_zPress-0.5*(v_xPress+v_yPress))*${convFac}
variable st equal 0.5*lz*(v_zPress-0.5*(v_xPress+v_yPress))*0.0101325
fix st all ave/time ${Ne} ${Nr} ${Nf} v_st
fix st all ave/time 10 ${Nr} ${Nf} v_st
fix st all ave/time 10 100 ${Nf} v_st
fix st all ave/time 10 100 2000 v_st

variable xyArea equal lx*ly

thermo_style custom step temp f_TAve press f_PAve v_xyArea lz f_st
thermo_modify flush yes
thermo ${Nf}
thermo 2000

compute cO oxygen chunk/atom bin/1d z center ${Dz} units box
compute cO oxygen chunk/atom bin/1d z center 0.1 units box
fix numDensO oxygen ave/chunk ${Ne} ${Nr} ${Nf} cO density/number     file numDensO.zProfile
fix numDensO oxygen ave/chunk 10 ${Nr} ${Nf} cO density/number     file numDensO.zProfile
fix numDensO oxygen ave/chunk 10 100 ${Nf} cO density/number     file numDensO.zProfile
fix numDensO oxygen ave/chunk 10 100 2000 cO density/number     file numDensO.zProfile

compute cH hydrogen chunk/atom bin/1d z center ${Dz} units box
compute cH hydrogen chunk/atom bin/1d z center 0.1 units box
fix numDensH hydrogen ave/chunk ${Ne} ${Nr} ${Nf} cH density/number     file numDensH.zProfile
fix numDensH hydrogen ave/chunk 10 ${Nr} ${Nf} cH density/number     file numDensH.zProfile
fix numDensH hydrogen ave/chunk 10 100 ${Nf} cH density/number     file numDensH.zProfile
fix numDensH hydrogen ave/chunk 10 100 2000 cH density/number     file numDensH.zProfile

compute A all chunk/atom bin/1d z center ${Dz} units box
compute A all chunk/atom bin/1d z center 0.1 units box

compute	charges all property/atom q
fix qDens all ave/chunk ${Ne} ${Nr} ${Nf} A c_charges file qDens.zProfile
fix qDens all ave/chunk 10 ${Nr} ${Nf} A c_charges file qDens.zProfile
fix qDens all ave/chunk 10 100 ${Nf} A c_charges file qDens.zProfile
fix qDens all ave/chunk 10 100 2000 A c_charges file qDens.zProfile

dump trj all atom ${Ndump} wat.lammpstrj
dump trj all atom 10 wat.lammpstrj
dump_modify trj scale no sort id
dump 1 all custom ${Ndump} dump.water id type x y z
dump 1 all custom 10 dump.water id type x y z

run ${Nrun}
run 2000
PPPM initialization ...
  extracting TIP4P info from pair style
  using 12-bit tables for long-range coulomb (../kspace.cpp:323)
  G vector (1/distance) = 0.231973
  grid = 24 24 60
  stencil order = 5
  estimated absolute RMS force accuracy = 0.00287124
  estimated relative force accuracy = 8.64665e-06
  using double precision KISS FFT
  3d grid and FFT values/proc = 9747 2880
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 15.3092
  ghost atom cutoff = 15.3092
  binsize = 7.6546, bins = 5 5 17
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut/tip4p/long, perpetual
      attributes: half, newton on
      pair build: half/bin/newton
      stencil: half/bin/3d/newton
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 10.74 | 11.78 | 13.85 Mbytes
Step Temp f_TAve Press f_PAve v_xyArea Lz f_st 
       0    450.07504            0     13632.19            0          961          124            0 
    2000     299.6452    300.43932   -207.88469   -25.791556          961          124    176.73715 
Loop time of 33.3428 on 12 procs for 2000 steps with 3000 atoms

Performance: 10.365 ns/day, 2.315 hours/ns, 59.983 timesteps/s
92.0% CPU use with 12 MPI tasks x no OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.0043912  | 8.9145     | 27.027     | 421.8 | 26.74
Bond    | 0.00038123 | 0.00052502 | 0.00073361 |   0.0 |  0.00
Kspace  | 2.9242     | 20.677     | 29.413     | 271.3 | 62.01
Neigh   | 2.2161     | 2.2231     | 2.2343     |   0.5 |  6.67
Comm    | 0.4161     | 0.44799    | 0.48321    |   3.3 |  1.34
Output  | 0.29334    | 0.30708    | 0.31874    |   1.3 |  0.92
Modify  | 0.38688    | 0.73334    | 0.92877    |  28.5 |  2.20
Other   |            | 0.03905    |            |       |  0.12

Nlocal:    250 ave 757 max 0 min
Histogram: 8 0 0 0 0 0 0 0 0 4
Nghost:    3432.58 ave 5910 max 2161 min
Histogram: 8 0 0 0 0 0 0 0 0 4
Neighs:    148753 ave 457695 max 0 min
Histogram: 8 0 0 0 0 0 0 0 0 4

Total # of neighbors = 1785040
Ave neighs/atom = 595.013
Ave special neighs/atom = 2
Neighbor list builds = 224
Dangerous builds = 0

#write_restart restart.wat
Total wall time: 0:00:33
